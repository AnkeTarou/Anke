<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-2.2.3.min.js"></script>
    <script src="js/lib.js"></script>
    <script src="nav.js" type="text/javascript"></script>
    <title>検索画面</title>

    <style media="screen">
        .card .card-header a[data-toggle="collapse"] {
            display: block;
            padding: .75rem 1.25rem;
            margin: -.75rem -1.25rem;
        }

        .card .card-header a[data-toggle="collapse"]:active,
        .card .card-header a[data-toggle="collapse"]:hover,
        .card .card-header a[data-toggle="collapse"]:focus {
            text-decoration: none; //リンクテキストの下線を消す
        }
    </style>

</head>

<body style="min-width :650px; background-color:#EEEEEE">
    <nav id="nav" class="navbar navbar-expand navbar-dark bg-primary">

    </nav>
    <div class="row align-items-start" >
        <div class="col-sm-1"></div>
        <!--投稿表示-->
        <div class="col-sm-10" >
            <div class="accordion" role="tablist" aria-multiselectable="true">
              <%
              for(let i = 0;i<result.length;i++){
              %>
                <div class="card" style="margin-top:10px;">
                    <div class="card-header" role="tab" id="headingOne" style="background-color:white">
                        <img class="rounded-circle" height="46" src="a.jpg" align="top" /><label><%= result[i].senderId %></label><label class="text-center text-muted">@<%= result[i].senderId%></label>
                        <a class="text-body" data-toggle="collapse" href=<%= '#'+ result[i]._id %> role="button" aria-expanded="false" aria-controls="collapseOne"><%= result[i].query%></a><br>
                        <div class="form-check-inline">
                            <i class="far fa-chart-bar"><%= result[i].total%></i>
                            <button type="button" class="btn btn-light btn-sm"><i class="far fa-heart"><%= result[i].favorite%></i></button>
                        </div>
                    </div>
                    <div id=<%= result[i]._id %> class="collapse" role="tabpanel" aria-labelledby="headingOne" data-parent="#accordion">
                        <div class="card-body">
                            <table class="table">
                                <tbody>
                                  <%
                                  for(let j = 0; j<result[i].answers.length; j++){
                                  %>
                                    <tr>
                                        <td>
                                            <div class="custom-control custom-<%= result[i].type %>">
                                                <input id=<%= result[i]._id + "-" + j %> name=<%= result[i]._id + "-answer" %> type=<%= result[i].type %> class="custom-control-input">
                                                <label class="custom-control-label" for=<%= result[i]._id + "-" +j %>><%= result[i].answers[j].answer %></label>
                                            </div>
                                        </td>
                                    </tr>
                                  <%
                                  }
                                  %>
                                </tbody>
                            </table>
                            <button type="button" class="btn btn-primary" name="vote">投票</button>
                            <div class="border-top"></div>
                        </div>
                    </div>
                </div>
              <%
              }
              %>
            </div>
        </div>
        <div class="col-sm-1"></div>
    </div>
    <script type="text/javascript">
        window.onload = function(){
          const btns = document.getElementsByName("vote");
          for(let btn of btns){
            btn.addEventListener("click",function(e){
              const id = e.target.parentElement.parentElement.id;
              const answers = document.getElementsByName(id + "-answer");
              const obj = {
                id:id,
                index:[]
              }
              for(let answer of answers){
                if(answer.checked){
                  obj.index.push(1);
                }else{
                  obj.index.push(0);
                }
              }
              connect("/vote/",obj,function(res){
                console.log(res)
              })
            })
          }
        }
    </script>
</body>

</html>
